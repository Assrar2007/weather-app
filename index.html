<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Weather Forecasts</title>
<style>
  :root{
    --purple-1:#6a42f4; --purple-2:#a645f7; --purple-3:#c26cf8;
    --glass-bg:rgba(255,255,255,.12); --glass-br:16px; --text:#fff;
    --yellow:#ffcf33; --muted:#d5c7ff; --card:#1f1f35;
  }
  *{box-sizing:border-box} body,html{height:100%;margin:0;font-family:Inter,system-ui,Arial}
  body{
    background: radial-gradient(1200px 600px at 10% 10%, #9a6bff33, transparent 60%),
                radial-gradient(900px 500px at 90% 20%, #ff7ac633, transparent 60%),
                linear-gradient(180deg,#3b267a 0%,#231a4a 100%);
    display:flex; align-items:center; justify-content:center; color:var(--text);
  }
  .phone{
    width: 380px; max-width: 100vw; height: 740px; max-height: 100vh;
    border-radius: 36px; overflow:hidden; position:relative;
    box-shadow: 0 30px 100px #0006, inset 0 0 0 1px #ffffff12;
    background: linear-gradient(180deg,#2a2156 0%,#15152b 100%);
  }

  /* Screens */
  .screen{position:absolute; inset:0; padding:22px; transition: transform .45s ease;
          display:flex; flex-direction:column;}
  .screen.hidden{transform:translateX(100%)}
  .screen.current{transform:translateX(0)}
  .top-bar{display:flex; justify-content:space-between; align-items:center; opacity:.8; font-size:12px}

  /* Screen 1 - Welcome */
  .welcome{
    background: radial-gradient(900px 600px at 20% -10%, #b27bff33, transparent 60%),
                linear-gradient(180deg,#2e215f 0%,#171733 100%);
    text-align:left; gap:20px; justify-content:space-between;
  }
  .hero{
    flex:1; display:flex; align-items:center; justify-content:center; position:relative;
  }
  .hero .blob{
    position:absolute; width:240px; height:240px; border-radius:50%;
    filter: blur(40px); background: radial-gradient(circle at 40% 40%, #ffd36a55, transparent 60%);
    transform:translate(-20px,-10px);
  }
  .hero .cloud{
    width:210px; height:210px; border-radius:50%;
    background: radial-gradient(circle at 40% 40%, #fff, #eaeaf3 60%);
    position:relative; box-shadow: 0 30px 60px #0006;
  }
  .raindrop{position:absolute; width:14px; height:38px; background:linear-gradient(#9fd3ff,#42a5ff);
    border-radius:10px; transform: rotate(20deg); opacity:.9}
  .raindrop.r1{left:145px; top:130px} .raindrop.r2{left:115px; top:150px} .raindrop.r3{left:175px; top:150px}

  .title{font-size:38px; font-weight:800; margin-top:10px; line-height:1.1}
  .title span{color:var(--yellow)}
  .cta{align-self:center; margin:10px 0 25px}
  .btn{
    background:var(--yellow); color:#2a1e00; border:none; border-radius:28px;
    padding:14px 26px; font-weight:700; cursor:pointer; box-shadow:0 8px 24px #0005;
  }

  /* Screen 2 - Main */
  .main{gap:8px}
  .search{
    display:flex; gap:8px; margin-top:10px;
    background:var(--glass-bg); padding:8px; border-radius:14px; backdrop-filter: blur(10px);
  }
  .search input{
    flex:1; background:#ffffff12; border:none; color:var(--text);
    padding:10px 12px; border-radius:10px; outline:none;
  }
  .search .btn{padding:10px 16px; border-radius:10px}
  .center{
    display:flex; flex-direction:column; align-items:center; text-align:center; margin-top:16px;
  }
  .big-temp{font-size:64px; font-weight:800; margin:10px 0}
  .muted{color:var(--muted); font-size:13px}
  .mini{
    margin-top:auto; background:var(--glass-bg); border-radius:18px; padding:12px; backdrop-filter: blur(10px);
  }
  .mini h4{margin:4px 6px 10px; font-weight:700; opacity:.9}
  .hours{display:flex; gap:10px; overflow-x:auto; padding-bottom:6px}
  .hour-card{
    min-width:76px; background:#ffffff10; border-radius:14px; padding:10px 8px; text-align:center;
  }
  .hour-card img{width:38px; height:38px}
  .more-btn{margin:12px auto 6px; background:var(--yellow); color:#2a1e00; border:none; border-radius:14px; padding:10px 16px; font-weight:700; cursor:pointer}

  /* Screen 3 - Slide-up details */
  .sheet{
    position:absolute; left:0; right:0; bottom:-68%; height:68%;
    background: linear-gradient(180deg,#14142b 0%, #0f0f21 100%);
    border-radius:24px 24px 0 0; box-shadow:0 -12px 40px #0008;
    transition: bottom .45s ease; display:flex; flex-direction:column; overflow:hidden;
  }
  .sheet.open{bottom:0}
  .grab{height:36px; display:flex; align-items:center; justify-content:center}
  .grab .handle{width:52px; height:5px; background:#ffffff2b; border-radius:6px}
  .sheet-scroll{overflow:auto; padding:12px 16px 26px}
  .row{display:flex; gap:10px; overflow-x:auto}
  .chip{
    min-width:74px; text-align:center; background:#ffffff10; border-radius:16px; padding:10px 8px;
  }
  .card{
    background:#ffffff10; padding:14px; border-radius:16px; margin:12px 0;
    display:flex; justify-content:space-between; align-items:center;
  }
  .tag{font-size:12px; opacity:.8}
  .value{font-weight:800; font-size:18px}
  .pill{padding:6px 10px; background:#ffffff18; border-radius:999px; font-size:12px}

  /* Utility */
  .hidden-vis{display:none}
</style>
</head>
<body>
  <div class="phone" id="app">
    <!-- Screen 1: Welcome -->
    <section class="screen welcome current" id="screen-welcome">
      <div class="top-bar"><span>1:41</span><span>‚óè ‚óè ‚óè</span></div>
      <div class="hero">
        <div class="blob"></div>
        <div class="cloud">
          <div class="raindrop r1"></div>
          <div class="raindrop r2"></div>
          <div class="raindrop r3"></div>
        </div>
      </div>
      <div>
        <div class="title">Weather<br><span>ForeCasts</span></div>
      </div>
      <div class="cta">
        <button class="btn" id="startBtn">Get Start</button>
      </div>
    </section>

    <!-- Screen 2: Main -->
    <section class="screen main hidden" id="screen-main">
      <div class="top-bar"><span id="locName">‚Äî</span><span id="minmax">Max ‚Äî Min ‚Äî</span></div>

      <!-- Search row with side button -->
      <div class="search">
        <input id="q" placeholder="Search city or 'lat,lon'‚Ä¶" />
        <button class="btn" id="goBtn">Get Weather</button>
      </div>

      <div class="center">
        <img id="iconBig" alt="" width="96" height="96" />
        <div class="big-temp" id="tempNow">‚Äî¬∞</div>
        <div class="muted" id="condNow">‚Äî</div>
        <div class="muted" id="localtime">‚Äî</div>
      </div>

      <div class="mini">
        <h4>Today</h4>
        <div class="hours" id="hoursRow"></div>
        <button class="more-btn" id="moreBtn">More Info</button>
      </div>
    </section>

    <!-- Screen 3: Details (slide-up sheet) -->
    <div class="sheet" id="sheet">
      <div class="grab" id="grab"><div class="handle"></div></div>
      <div class="sheet-scroll">
        <div class="row" id="dailyRow"></div>

        <div class="card">
          <div>
            <div class="tag">AIR QUALITY (US EPA)</div>
            <div class="value" id="aqiLabel">‚Äî</div>
          </div>
          <div class="pill" id="aqiCat">‚Äî</div>
        </div>

        <div class="card">
          <div>
            <div class="tag">Sunrise</div>
            <div class="value" id="sunrise">‚Äî</div>
          </div>
          <div>
            <div class="tag">Sunset</div>
            <div class="value" id="sunset">‚Äî</div>
          </div>
        </div>

        <div class="card">
          <div>
            <div class="tag">UV INDEX</div>
            <div class="value" id="uv">‚Äî</div>
          </div>
          <div class="pill" id="uvCat">‚Äî</div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ---- Config ----
  const API_KEY = "c40169736ffd434b840135931252708";
  const API = (q) =>
    `https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${encodeURIComponent(q)}&days=7&aqi=yes&alerts=no`;

  // ---- Elements ----
  const screenWelcome = document.getElementById('screen-welcome');
  const screenMain    = document.getElementById('screen-main');
  const startBtn  = document.getElementById('startBtn');
  const goBtn     = document.getElementById('goBtn');
  const qInput    = document.getElementById('q');
  const moreBtn   = document.getElementById('moreBtn');
  const sheet     = document.getElementById('sheet');
  const grab      = document.getElementById('grab');

  const locName   = document.getElementById('locName');
  const minmax    = document.getElementById('minmax');
  const iconBig   = document.getElementById('iconBig');
  const tempNow   = document.getElementById('tempNow');
  const condNow   = document.getElementById('condNow');
  const localtime = document.getElementById('localtime');
  const hoursRow  = document.getElementById('hoursRow');
  const dailyRow  = document.getElementById('dailyRow');

  const aqiLabel  = document.getElementById('aqiLabel');
  const aqiCat    = document.getElementById('aqiCat');
  const sunriseEl = document.getElementById('sunrise');
  const sunsetEl  = document.getElementById('sunset');
  const uvEl      = document.getElementById('uv');
  const uvCat     = document.getElementById('uvCat');

  // ---- Navigation ----
  startBtn.addEventListener('click', () => {
    screenWelcome.classList.add('hidden');
    screenWelcome.classList.remove('current');
    screenMain.classList.remove('hidden');
    screenMain.classList.add('current');
    // initial fetch (try geolocation, else London)
    initFetch();
  });

  // ---- Fetch Logic ----
  async function fetchWeather(query){
    const res = await fetch(API(query));
    if(!res.ok) throw new Error('API error');
    return res.json();
  }

  function setBackgroundByCondition(txt){
    const t = txt.toLowerCase();
    // gentle gradient variants like your mock
    if(t.includes('rain')) {
      document.querySelector('.phone').style.background =
        'linear-gradient(180deg,#282c54 0%,#191b33 100%)';
    } else if(t.includes('cloud')) {
      document.querySelector('.phone').style.background =
        'linear-gradient(180deg,#2b2b5d 0%,#1b1b38 100%)';
    } else if(t.includes('snow')) {
      document.querySelector('.phone').style.background =
        'linear-gradient(180deg,#485c91 0%,#1c2541 100%)';
    } else {
      document.querySelector('.phone').style.background =
        'linear-gradient(180deg,#2a2156 0%,#15152b 100%)';
    }
  }

  function aqiCategory(usEpaIndex){
    // 1 Good, 2 Moderate, 3 Unhealthy for sensitive, 4 Unhealthy, 5 Very Unhealthy, 6 Hazardous
    const map = {
      1: ['Good','Good'],
      2: ['Moderate','Moderate'],
      3: ['Unhealthy (Sensitive)','Unhealthy (Sens.)'],
      4: ['Unhealthy','Unhealthy'],
      5: ['Very Unhealthy','Very Unhealthy'],
      6: ['Hazardous','Hazardous'],
      undefined: ['N/A','N/A']
    };
    return map[usEpaIndex] || map[undefined];
  }

  function uvCategory(uv){
    if(uv == null) return 'N/A';
    if(uv < 3) return 'Low';
    if(uv < 6) return 'Moderate';
    if(uv < 8) return 'High';
    if(uv < 11) return 'Very High';
    return 'Extreme';
  }

  function renderCurrent(data){
    const { location, current, forecast } = data;
    locName.textContent = `${location.name}`;
    const today = forecast.forecastday[0].day;
    minmax.textContent = `Max: ${Math.round(today.maxtemp_c)}¬∞  Min: ${Math.round(today.mintemp_c)}¬∞`;

    iconBig.src = "https:" + current.condition.icon;
    iconBig.alt = current.condition.text;
    tempNow.textContent = Math.round(current.temp_c) + "¬∞";
    condNow.textContent = current.condition.text;
    localtime.textContent = `üïí ${location.localtime}`;

    setBackgroundByCondition(current.condition.text);
  }

  function renderHours(data){
    const hours = data.forecast.forecastday[0].hour;
    hoursRow.innerHTML = '';
    const now = new Date(data.location.localtime.replace(' ', 'T'));
    // show next 8 hours
    let shown = 0;
    for(const h of hours){
      const dt = new Date(h.time.replace(' ', 'T'));
      if(dt >= now && shown < 8){
        const el = document.createElement('div');
        el.className = 'hour-card';
        el.innerHTML = `
          <div style="opacity:.8;font-size:12px">${dt.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
          <img src="https:${h.condition.icon}" alt="">
          <div style="font-weight:700">${Math.round(h.temp_c)}¬∞C</div>`;
        hoursRow.appendChild(el);
        shown++;
      }
    }
    if(shown === 0){ // fallback morning hours
      hours.slice(8,16).forEach(h=>{
        const dt = new Date(h.time.replace(' ', 'T'));
        const el = document.createElement('div');
        el.className = 'hour-card';
        el.innerHTML = `
          <div style="opacity:.8;font-size:12px">${dt.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
          <img src="https:${h.condition.icon}" alt="">
          <div style="font-weight:700">${Math.round(h.temp_c)}¬∞C</div>`;
        hoursRow.appendChild(el);
      });
    }
  }

  function renderDaily(data){
    dailyRow.innerHTML = '';
    data.forecast.forecastday.forEach((d, idx)=>{
      const date = new Date(d.date);
      const day = date.toLocaleDateString([], {weekday:'short'});
      const el = document.createElement('div');
      el.className = 'chip';
      el.innerHTML = `
        <div style="font-weight:700">${Math.round(d.day.maxtemp_c)}¬∞C</div>
        <img src="https:${d.day.condition.icon}" alt="" width="38" height="38">
        <div style="opacity:.85">${day}</div>`;
      dailyRow.appendChild(el);
      if(idx===0){
        sunriseEl.textContent = d.astro.sunrise;
        sunsetEl.textContent  = d.astro.sunset;
      }
    });
  }

  function renderAQI_UV(data){
    const epa = data.current?.air_quality?.["us-epa-index"];
    const [label, short] = aqiCategory(epa);
    aqiLabel.textContent = label;
    aqiCat.textContent   = short;

    const uv = data.current?.uv;
    uvEl.textContent  = uv != null ? uv.toFixed(1) : '‚Äî';
    uvCat.textContent = uvCategory(uv);
  }

  async function updateAll(query){
    try{
      const data = await fetchWeather(query);
      renderCurrent(data);
      renderHours(data);
      renderDaily(data);
      renderAQI_UV(data);
    }catch(e){
      alert("Couldn't fetch weather. Try another location.");
      console.error(e);
    }
  }

  // initial geolocation (optional)
  function initFetch(){
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(
        pos => updateAll(`${pos.coords.latitude},${pos.coords.longitude}`),
        ()  => updateAll('London')
      );
    } else {
      updateAll('London');
    }
  }

  // Search
  goBtn.addEventListener('click', ()=> {
    const q = qInput.value.trim();
    if(q) updateAll(q);
  });
  qInput.addEventListener('keydown', e=>{
    if(e.key === 'Enter'){ goBtn.click(); }
  });

  // ---- Sheet open/close (tap or drag) ----
  const toggleSheet = () => sheet.classList.toggle('open');
  moreBtn.addEventListener('click', toggleSheet);
  grab.addEventListener('click', toggleSheet);

  // Drag to open/close
  let startY=null, startBottom=null;
  function onStart(y){
    startY=y; startBottom = parseFloat(getComputedStyle(sheet).bottom);
    sheet.style.transition='none';
  }
  function onMove(y){
    if(startY===null) return;
    const dy = y - startY;
    let newBottom = startBottom - dy;
    newBottom = Math.max(-sheet.offsetHeight*0.98, Math.min(0, newBottom));
    sheet.style.bottom = newBottom + 'px';
  }
  function onEnd(){
    sheet.style.transition='';
    // snap
    const openThreshold = -sheet.offsetHeight * 0.35;
    const b = parseFloat(getComputedStyle(sheet).bottom);
    sheet.classList.toggle('open', b > openThreshold);
    if(!sheet.classList.contains('open')) sheet.style.bottom = '';
  }

  // touch
  sheet.addEventListener('touchstart', e=> onStart(e.touches[0].clientY), {passive:true});
  sheet.addEventListener('touchmove',  e=> onMove(e.touches[0].clientY), {passive:true});
  sheet.addEventListener('touchend', onEnd);
  // mouse (for desktop testing)
  let mouseDown=false;
  grab.addEventListener('mousedown', e=>{mouseDown=true; onStart(e.clientY);});
  window.addEventListener('mousemove', e=>{ if(mouseDown) onMove(e.clientY); });
  window.addEventListener('mouseup', ()=>{ if(mouseDown){ mouseDown=false; onEnd(); }});
</script>
</body>
</html>
